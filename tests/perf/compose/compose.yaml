services:
  node1:
    build:
      context: ../../..
      dockerfile: docker/Dockerfile
    image: fluxmq-perf:local
    command: ["-config", "/etc/fluxmq/config.yaml"]
    volumes:
      - ./config/node1.yaml:/etc/fluxmq/config.yaml:ro
      - fluxmq-perf-node1-data:/var/lib/fluxmq
    ports:
      - "11883:1883" # MQTT
      - "15672:5672" # AMQP 1.0
      - "15682:5682" # AMQP 0.9.1
      - "18081:8081" # Health
    restart: unless-stopped

  node2:
    image: fluxmq-perf:local
    command: ["-config", "/etc/fluxmq/config.yaml"]
    volumes:
      - ./config/node2.yaml:/etc/fluxmq/config.yaml:ro
      - fluxmq-perf-node2-data:/var/lib/fluxmq
    ports:
      - "11884:1883" # MQTT
      - "15673:5672" # AMQP 1.0
      - "15683:5682" # AMQP 0.9.1
      - "18082:8081" # Health
    restart: unless-stopped
    depends_on:
      - node1

  node3:
    image: fluxmq-perf:local
    command: ["-config", "/etc/fluxmq/config.yaml"]
    volumes:
      - ./config/node3.yaml:/etc/fluxmq/config.yaml:ro
      - fluxmq-perf-node3-data:/var/lib/fluxmq
    ports:
      - "11885:1883" # MQTT
      - "15674:5672" # AMQP 1.0
      - "15684:5682" # AMQP 0.9.1
      - "18083:8081" # Health
    restart: unless-stopped
    depends_on:
      - node1

volumes:
  fluxmq-perf-node1-data:
  fluxmq-perf-node2-data:
  fluxmq-perf-node3-data:

