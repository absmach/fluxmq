# MQTT Broker - 3-Node Cluster: Node 2
# Second node joining the cluster
# Run all three nodes simultaneously to form the cluster

server:
  tcp_addr: ":1884"
  tcp_max_connections: 10000
  tcp_read_timeout: "60s"
  tcp_write_timeout: "60s"

  http_enabled: false
  ws_enabled: false
  coap_enabled: false

  health_enabled: true
  health_addr: ":8082"

  shutdown_timeout: "30s"

broker:
  max_message_size: 1048576
  max_retained_messages: 10000
  retry_interval: "20s"
  max_retries: 0

session:
  max_sessions: 1000000
  default_expiry_interval: 300
  max_offline_queue_size: 1000
  max_inflight_messages: 100

storage:
  type: "badger"
  badger_dir: "/tmp/fluxmq/node2/data"

cluster:
  enabled: true
  node_id: "node2"

  etcd:
    data_dir: "/tmp/fluxmq/node2/etcd"
    bind_addr: "127.0.0.1:2480"
    client_addr: "127.0.0.1:2479"
    initial_cluster: "node1=http://127.0.0.1:2380,node2=http://127.0.0.1:2480,node3=http://127.0.0.1:2580"
    bootstrap: true  # Part of initial cluster formation

  transport:
    bind_addr: "127.0.0.1:7949"
    peers:
      node1: "127.0.0.1:7948"
      node3: "127.0.0.1:7950"

  raft:
    enabled: true
    replication_factor: 3
    sync_mode: true
    min_in_sync_replicas: 2
    ack_timeout: "5s"
    bind_addr: "127.0.0.1:7200"
    data_dir: "/tmp/fluxmq/node2/raft"
    peers:
      node1: "127.0.0.1:7100"
      node3: "127.0.0.1:7300"
    heartbeat_timeout: "1s"
    election_timeout: "3s"
    snapshot_interval: "5m"
    snapshot_threshold: 8192

log:
  level: "debug"
  format: "text"
