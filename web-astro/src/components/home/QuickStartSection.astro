---
import CodePanel from './CodePanel.astro';

const dockerSnippet = `git clone https://github.com/absmach/fluxmq.git
cd fluxmq
docker compose -f docker/compose.yaml up -d`;

const mqttSnippet = `# Subscribe to all topics
mosquitto_sub -p 1883 -t "test/#" -v

# Publish a message
mosquitto_pub -p 1883 -t "test/hello" -m "Hello FluxMQ"`;

const localSnippet = `git clone https://github.com/absmach/fluxmq.git
cd fluxmq
make build
./build/fluxmq --config examples/no-cluster.yaml`;
---

<section id="quick-start" class="border-b-2 border-[var(--flux-border)] py-20">
  <div class="mx-auto w-[min(100%-2.5rem,1200px)]">
    <h2 class="mb-8 text-[clamp(2rem,4vw,3rem)] leading-tight font-bold uppercase tracking-[0.03em]">
      <span class="border-l-[5px] border-[var(--flux-orange)] pl-3">Quick Start</span>
    </h2>

    <div class="space-y-8">
      <div>
        <h3 class="mono mb-3 text-xl font-bold">1. Run with Docker</h3>
        <CodePanel code={dockerSnippet} />
      </div>

      <div>
        <h3 class="mono mb-3 text-xl font-bold">2. Test with MQTT</h3>
        <CodePanel code={mqttSnippet} />
      </div>

      <div>
        <h3 class="mono mb-3 text-xl font-bold">3. Or Build Locally</h3>
        <CodePanel code={localSnippet} />
      </div>

      <div class="cluster-box">
        <p class="mono text-sm md:text-base"><strong>Defaults:</strong> MQTT TCP :1883, AMQP 0.9.1 :5682, Data /tmp/fluxmq/data</p>
        <p class="mono mt-3"><strong>Next Steps:</strong></p>
        <ul class="mt-2 list-none space-y-2 p-0">
          <li>
            <a
              class="font-bold text-[var(--flux-blue)] hover:text-[var(--flux-orange)]"
              href="https://github.com/absmach/fluxmq/tree/main/examples"
              target="_blank"
              rel="noopener noreferrer"
            >
              Explore code examples on GitHub
            </a>
          </li>
          <li>
            <a class="font-bold text-[var(--flux-blue)] hover:text-[var(--flux-orange)]" href="/docs/">
              Read the full documentation
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script is:inline>
    const copyButtons = document.querySelectorAll('[data-copy-btn]');
    for (const button of copyButtons) {
      button.addEventListener('click', async () => {
        const panel = button.closest('.code-panel');
        const code = panel?.querySelector('code')?.textContent ?? '';

        if (!code) return;

        await navigator.clipboard.writeText(code);
        const original = button.textContent;
        button.textContent = 'Copied';
        window.setTimeout(() => {
          button.textContent = original;
        }, 1600);
      });
    }
  </script>
</section>
